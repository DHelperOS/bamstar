[ë°¤ìŠ¤íƒ€] ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥ ìƒì„¸ ëª…ì„¸ì„œ
1. í•µì‹¬ ì² í•™ ë° ëª©í‘œ
1.1. ëª©í‘œ
ë©¤ë²„(ìŠ¤íƒ€)ë“¤ì—ê²Œ ê°•ë ¥í•œ ì†Œì†ê°ê³¼ ì •ì„œì  ìœ ëŒ€ë¥¼ ì œê³µí•˜ì—¬, ì±„ìš© í™œë™ì´ ëë‚˜ë„ ì•±ì„ ê³„ì† ì‚¬ìš©í•˜ê²Œ ë§Œë“œëŠ” **'ë– ë‚  ìˆ˜ ì—†ëŠ” ì»¤ë®¤ë‹ˆí‹°'**ë¥¼ êµ¬ì¶•í•œë‹¤.
1.2. í•µì‹¬ ì›ì¹™
ë©¤ë²„(ìŠ¤íƒ€) ì „ìš© ê³µê°„: í”Œë ˆì´ìŠ¤ì˜ ì ‘ê·¼ì„ ì›ì²œì ìœ¼ë¡œ ì°¨ë‹¨í•˜ì—¬, ìŠ¤íƒ€ë“¤ë§Œì˜ **ì™„ë²½í•œ 'ì•ˆì „ì§€ëŒ€'**ë¥¼ ë³´ì¥í•œë‹¤.
ììœ ì™€ ì§ˆì„œì˜ ì¡°í™”: ìŠ¤íƒ€ë“¤ì˜ ììœ ë¡œìš´ í‘œí˜„ì„ ìµœëŒ€í•œ ë³´ì¥í•˜ë˜, ì‹œìŠ¤í…œ(AI)ì´ ë’¤ì—ì„œ ì¡°ìš©íˆ ì§ˆì„œë¥¼ ìœ ì§€í•˜ê³  ì •ë³´ì˜ ê°€ì¹˜ë¥¼ ë†’ì¸ë‹¤.
ì •ë³´ì˜ ê³µê³µì¬í™”: ìŠ¤íƒ€ ê°„ 1:1 ì±„íŒ…ì„ ê¸ˆì§€í•˜ì—¬, ëª¨ë“  ìœ ìš©í•œ ì •ë³´ê°€ ì»¤ë®¤ë‹ˆí‹°ë¼ëŠ” 'ê³µê°œëœ ê´‘ì¥'ì— ì¶•ì ë˜ë„ë¡ í•œë‹¤.
2. ì£¼ìš” ê¸°ëŠ¥ ë° UI/UX ì„¤ê³„
2.1. ë©”ì¸ í”¼ë“œ (Community Home)
UI: ê°œì¸í™”ëœ ì„¸ë¡œ ìŠ¤í¬ë¡¤ í†µí•© í”¼ë“œ.
ì½˜í…ì¸ : êµ¬ë…í•œ #ì±„ë„/ìŠ¤íƒ€ì˜ ê¸€, AI ì¶”ì²œ ê¸€, ì¸ê¸° ê¸€ì´ í˜¼í•© ë…¸ì¶œ.
í•„í„°: í™”ë©´ ìƒë‹¨ì— êµ¬ë… ì±„ë„ ëª©ë¡ì„ 'ê°€ë¡œ ìŠ¤í¬ë¡¤ ì¹©(Chip)' í˜•íƒœë¡œ ì œê³µí•˜ì—¬, íƒ­ìœ¼ë¡œ í”¼ë“œë¥¼ í•„í„°ë§.
ê²Œì‹œê¸€ ì¹´ë“œ:
ëŒ“ê¸€ ì‘ì„±ì ìŠ¤íƒ: ëŒ“ê¸€ ë‹¨ ìŠ¤íƒ€ë“¤ì˜ í”„ë¡œí•„ ì‚¬ì§„ì„ ë™ê·¸ë—ê²Œ ê²¹ì³ ë³´ì´ëŠ” 'ìŠ¤íƒ(Stack)' UIë¡œ ê¸€ì˜ í™œì„±ë„ë¥¼ ì‹œê°í™”.
ìµëª… ê¸€ ì‹œê°ì  êµ¬ë¶„: 'ìµëª… ì „ìš© ì•„ì´ì½˜'ê³¼ ë‹‰ë„¤ì„, ê·¸ë¦¬ê³  ì¹´ë“œ ì¢Œì¸¡ì— 'í‘œì‹œ ë°”'ë¥¼ ë‘ì–´ ëª…í™•íˆ êµ¬ë¶„.
2.2. ê¸€ì“°ê¸° (Create Post)
ì§„ì…ì : í™”ë©´ ìš°ì¸¡ í•˜ë‹¨ì˜ í”Œë¡œíŒ… ì•¡ì…˜ ë²„íŠ¼(FAB).
í•µì‹¬ ê¸°ëŠ¥: ìµëª… ìŠ¤ìœ„ì¹˜
UI: ê¸€ì“°ê¸° ì—ë””í„° í•˜ë‹¨ì˜ ì§ê´€ì ì¸ í† ê¸€ ìŠ¤ìœ„ì¹˜.
ìŠ¤ìœ„ì¹˜ OFF: ë³¸ë˜ ë‹‰ë„¤ì„/í”„ë¡œí•„ë¡œ ê²Œì‹œ. (ì¼ìƒ/ì†Œì…œìš©)
ìŠ¤ìœ„ì¹˜ ON: 'ìµëª…ì˜ ìŠ¤íƒ€'ë¡œ ê²Œì‹œ. (ë¯¼ê° ì •ë³´ ê³µìœ ìš©)
ì²¨ë¶€ ê¸°ëŠ¥: í…ìŠ¤íŠ¸, ì´ë¯¸ì§€(ì—¬ëŸ¬ ì¥) ì²¨ë¶€ ê°€ëŠ¥.
2.3. ëŒ“ê¸€ (Comments)
ê³„ì¸µ êµ¬ì¡°: **ëŒ€ëŒ“ê¸€(Threaded Comments)**ì„ ì§€ì›í•˜ì—¬ ê¹Šì´ ìˆëŠ” ëŒ€í™”ê°€ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„.
ì²¨ë¶€ ê¸°ëŠ¥: í…ìŠ¤íŠ¸ì™€ í•¨ê»˜, **ì´ë¯¸ì§€(1ì¥)**ë¥¼ ì²¨ë¶€í•˜ì—¬ 'ì§¤'ì´ë‚˜ ì¸ì¦ìƒ· ë“±ìœ¼ë¡œ í’ë¶€í•œ ì†Œí†µì´ ê°€ëŠ¥í•˜ë„ë¡ ì§€ì›.
ìƒí˜¸ì‘ìš©: ê°œë³„ ëŒ“ê¸€ì—ë„ **'ì¢‹ì•„ìš”'**ë¥¼ ëˆ„ë¥¼ ìˆ˜ ìˆìŒ.
2.4. #í•´ì‹œíƒœê·¸ ì±„ë„ ì‹œìŠ¤í…œ
ì±„ë„ ìë™ ìƒì„±: ìŠ¤íƒ€ê°€ ê¸€ ì‘ì„± ì‹œ, ì¡´ì¬í•˜ì§€ ì•Šë˜ #í•´ì‹œíƒœê·¸ë¥¼ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ 'ì±„ë„'ì´ ìë™ìœ¼ë¡œ ìƒì„±ë¨.
ìœ ì‚¬ ì±„ë„ ë‚œë¦½ ë°©ì§€ ('ë³´ì´ì§€ ì•ŠëŠ”' ìë™í™”):
AI íƒœê·¸ í†µí•©: ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì£¼ê¸°ì ìœ¼ë¡œ AIê°€ ìœ ì‚¬ íƒœê·¸ë¥¼ ìë™ìœ¼ë¡œ ê·¸ë£¹í•‘í•˜ê³  **'ëŒ€í‘œ ì±„ë„'**ì„ ì§€ì •.
AI ì„¤ëª… ìƒì„±: AIê°€ ì‹ ê·œ ì±„ë„ì˜ ì´ë¦„ê³¼ ì´ˆê¸° ê²Œì‹œê¸€ ë§¥ë½ì„ ë¶„ì„í•˜ì—¬ 'ì±„ë„ ì„¤ëª…'ì„ ìë™ìœ¼ë¡œ ìƒì„±.
íƒœê·¸ ìë™ì™„ì„±: ê¸€ì“°ê¸° ì‹œ, ì¸ê¸° ìˆëŠ” 'ëŒ€í‘œ ì±„ë„'ì„ ë¨¼ì € ì¶”ì²œí•˜ì—¬ í‘œì¤€í™”ëœ íƒœê·¸ ì‚¬ìš© ìœ ë„.
2.5. ì±„ë„ íƒìƒ‰ (Channel Explorer)
ì§„ì…ì : ì»¤ë®¤ë‹ˆí‹° í™ˆ í—¤ë”ì˜ ğŸ§­ ì•„ì´ì½˜.
UI êµ¬ì„±:
ê²€ìƒ‰ ë°”: ì±„ë„ëª… ì§ì ‘ ê²€ìƒ‰.
ë­í‚¹: ğŸ‘‘ ì§€ê¸ˆ ëœ¨ëŠ” ì±„ë„, ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ ë“±ìœ¼ë¡œ ë°œê²¬ì˜ ì¬ë¯¸ ì œê³µ.
ì¹´í…Œê³ ë¦¬: AIê°€ ìë™ìœ¼ë¡œ ë¶„ë¥˜í•œ [ğŸ“ ì§€ì—­ ì •ë³´], [ğŸ’¡ ì—…ë¬´ ë…¸í•˜ìš°] ë“±ìœ¼ë¡œ ì²´ê³„ì  íƒìƒ‰.
3. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ (Supabase/PostgreSQL)
3.1. í…Œì´ë¸” ìƒì„± SQL (Full)
code
SQL
-- ==========[ ì„¹ì…˜ 0: ì‚¬ì „ ì¤€ë¹„ - ê³µìš© ìë™í™” í•¨ìˆ˜ ìƒì„± ]==========
CREATE OR REPLACE FUNCTION public.handle_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = now();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- ==========[ ì„¹ì…˜ 1: ì»¤ë®¤ë‹ˆí‹° í•µì‹¬ í…Œì´ë¸” ìƒì„± ]==========
CREATE TABLE public.community_posts (
  id BIGSERIAL PRIMARY KEY,
  author_id UUID NOT NULL REFERENCES public.users(id) ON DELETE SET NULL,
  content TEXT NOT NULL,
  is_anonymous BOOLEAN NOT NULL DEFAULT false,
  image_urls TEXT[],
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  updated_at TIMESTAMPTZ
);

CREATE TABLE public.community_hashtags (
  id SERIAL PRIMARY KEY,
  name TEXT UNIQUE NOT NULL,
  description TEXT,
  category TEXT,
  post_count INT NOT NULL DEFAULT 0,
  subscriber_count INT NOT NULL DEFAULT 0,
  last_used_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  parent_hashtag_id INT REFERENCES public.community_hashtags(id) -- ìœ ì‚¬ íƒœê·¸ ê·¸ë£¹í•‘ìš©
);

CREATE TABLE public.post_hashtags (
  post_id BIGINT NOT NULL REFERENCES public.community_posts(id) ON DELETE CASCADE,
  hashtag_id INT NOT NULL REFERENCES public.community_hashtags(id) ON DELETE CASCADE,
  PRIMARY KEY (post_id, hashtag_id)
);

CREATE TABLE public.community_subscriptions (
  id BIGSERIAL PRIMARY KEY,
  subscriber_id UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE,
  target_hashtag_id INT REFERENCES public.community_hashtags(id) ON DELETE CASCADE,
  target_member_id UUID REFERENCES public.users(id) ON DELETE CASCADE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  CONSTRAINT unique_subscription_check UNIQUE (subscriber_id, target_hashtag_id, target_member_id),
  CONSTRAINT target_presence_check CHECK (num_nonnulls(target_hashtag_id, target_member_id) = 1)
);

CREATE TABLE public.community_comments (
  id BIGSERIAL PRIMARY KEY,
  post_id BIGINT NOT NULL REFERENCES public.community_posts(id) ON DELETE CASCADE,
  author_id UUID NOT NULL REFERENCES public.users(id) ON DELETE SET NULL,
  content TEXT, 
  image_url TEXT, 
  is_anonymous BOOLEAN NOT NULL DEFAULT false,
  parent_comment_id BIGINT REFERENCES public.community_comments(id) ON DELETE CASCADE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  CONSTRAINT content_or_image_check CHECK (num_nonnulls(content, image_url) > 0)
);

CREATE TABLE public.community_likes (
  id BIGSERIAL PRIMARY KEY,
  user_id UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE,
  post_id BIGINT REFERENCES public.community_posts(id) ON DELETE CASCADE,
  comment_id BIGINT REFERENCES public.community_comments(id) ON DELETE CASCADE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  CONSTRAINT unique_post_like UNIQUE (user_id, post_id),
  CONSTRAINT unique_comment_like UNIQUE (user_id, comment_id),
  CONSTRAINT target_like_check CHECK (num_nonnulls(post_id, comment_id) = 1)
);

-- ==========[ ì„¹ì…˜ 2: ìë™í™”ë¥¼ ìœ„í•œ í•¨ìˆ˜ ë° íŠ¸ë¦¬ê±° ]==========
-- (ì´ì „ ë‹µë³€ê³¼ ë™ì¼í•œ handle_post_hashtags, trigger_handle_post_hashtags, update_hashtag_subscriber_count ë“± í•¨ìˆ˜ ë° íŠ¸ë¦¬ê±°)

### 3.2. ë°ì´í„°ë² ì´ìŠ¤ í•¨ìˆ˜ (RPC)
```sql
-- ëŒ“ê¸€ ì‘ì„±ì í”„ë¡œí•„ ìŠ¤íƒ ì¡°íšŒë¥¼ ìœ„í•œ DB í•¨ìˆ˜ (users í…Œì´ë¸” ì§ì ‘ ì¡°íšŒ)
CREATE OR REPLACE FUNCTION public.get_post_commenter_avatars(post_id_in BIGINT, limit_in INT)
RETURNS TABLE (profile_image_url TEXT) LANGUAGE sql STABLE AS $$
  WITH recent_commenters AS (
    SELECT author_id, MAX(created_at) AS last_comment_time
    FROM public.community_comments
    WHERE post_id = post_id_in AND is_anonymous = false
    GROUP BY author_id
    ORDER BY last_comment_time DESC
    LIMIT limit_in
  )
  SELECT u.profile_image_url
  FROM public.users u
  JOIN recent_commenters rc ON u.id = rc.author_id
  ORDER BY rc.last_comment_time DESC;
$$;
4. ë³´ì•ˆ (Row Level Security)
4.1. RLS ì •ì±… SQL
code
SQL
-- ê²Œì‹œê¸€ (community_posts)
ALTER TABLE public.community_posts ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow read access to authenticated users" ON public.community_posts FOR SELECT USING (auth.role() = 'authenticated');
CREATE POLICY "Allow users to manage their own posts" ON public.community_posts FOR INSERT, UPDATE, DELETE USING (auth.uid() = author_id);

-- ëŒ“ê¸€ (community_comments)
ALTER TABLE public.community_comments ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow read access to authenticated users" ON public.community_comments FOR SELECT USING (auth.role() = 'authenticated');
CREATE POLICY "Allow users to manage their own comments" ON public.community_comments FOR INSERT, UPDATE, DELETE USING (auth.uid() = author_id);

-- ê³µê°/ì¢‹ì•„ìš” (community_likes)
ALTER TABLE public.community_likes ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow read access to authenticated users" ON public.community_likes FOR SELECT USING (auth.role() = 'authenticated');
CREATE POLICY "Allow users to manage their own likes" ON public.community_likes FOR INSERT, DELETE USING (auth.uid() = user_id);

-- êµ¬ë… (community_subscriptions)
ALTER TABLE public.community_subscriptions ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow users to read their own subscriptions" ON public.community_subscriptions FOR SELECT USING (auth.uid() = subscriber_id);
CREATE POLICY "Allow users to manage their own subscriptions" ON public.community_subscriptions FOR INSERT, DELETE USING (auth.uid() = subscriber_id);

-- #í•´ì‹œíƒœê·¸ í…Œì´ë¸” (ì½ê¸° ì „ìš©)
ALTER TABLE public.community_hashtags ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Allow read access to all users" ON public.community_hashtags FOR SELECT USING (true);